(function(t){t.fn.jqdata=function(a){var n=t.extend({dataAttr:"jqdata",json:null,beforeBind:function(){},afterBind:function(){},dataChanged:function(){}},a),e=this,i=jQuery.extend(!0,{},n.json),r=n.dataAttr;e.data("templates",{});var o=function(a){var n=t(a.target),i=n.attr("data-"+r),o=n.val();n.is("[data-"+r+"-format]")&&(o=o.replace(new RegExp(n.attr("data-"+r+"-format").replace("{value}","|"),"ig"),"")),u(i,o),d(e,i,o)},f=function(a){var n=t(a.target),e=n.attr("data-"+r+"-format");n.val(n.val().replace(new RegExp(e.replace("{value}","|"),"ig"),""))},d=function(a,i,d){a||(a=t("body"));var s=t("[data-"+r+'="'+i+'"]',a);if(null!=d&&"object"==typeof d&&d.hasOwnProperty(0)){var u=t("[data-"+r+'="'+i+'.{n}"]',a);if(u.length>0){var c=e.data("templates")[i+".{n}"],l=u.parent();void 0===c&&(c=e.data("templates")[i+".{n}"]={ref:u.clone(),html:u.prop("outerHTML"),prt:l},u.remove());for(var p=0;p<d.length;p++)l.append(c.html.replace(new RegExp('"'+i+".{n}","g"),'"'+i+"."+p))}}s.each(function(){if("object"!=typeof d){var a=d;t(this).is("[data-"+r+"-format]")&&(a=t(this).attr("data-"+r+"-format").replace("\\","").replace("{value}",a)),t(this).is(':input[type="radio"], :input[type="checkbox"]')?t(this).is('[value="'+a+'"]')&&t(this).prop("checked",!0):t(this).is(":input")?t(this).is(":focus")||t(this).val(a):t(this).html(a)}if(t(this).is("[data-"+r+"-databind]")){var e=t(this).attr("data-"+r+"-databind");"function"==typeof window[e]&&window[e].apply(this,[t(this),d,n.json,i])}if(t(this).is("[data-"+r+"-format]")){t(this).attr("data-"+r+"-format");t(this).off("focus",f).on("focus",f)}if(t(this).is("[data-"+r+"-bindevent]")){var s=t(this).attr("data-"+r+"-bindevent");t(this).off(s,o).on(s,o)}})},s=function(t,a,n,e){for(var i in a){var r=void 0!==e?e+"."+i:i;n.apply(this,[t,r,a[i]]),null!==a[i]&&"object"==typeof a[i]&&s(t,a[i],n,r)}},u=function(t,a){for(var i=t.split("."),r=n.json,o="",f=0;f<i.length;f++){if(void 0===r[i[f]]){r[i[f]]=null;break}"object"==typeof r[i[f]]?r=r[i[f]]:(o=r[i[f]],r[i[f]]=a)}n.dataChanged(e,t,o,a)},c=function(){t("[data-"+r+'$=".{n}"]',e).remove()},l=function(){n.beforeBind(e),s(e,n.json,d),c(),n.afterBind(e)};return e.rebind=function(){l()},e.getData=function(){return n.json},e.getOriginalData=function(){return i},e.reset=function(){n.json=jQuery.extend(!0,{},i),l()},l(),e}})(jQuery);