/*! jQData v1.0 | (c) 2015, 2016 Ary Pambudi W | MIT license */
(function(n){n.fn.jqdata=function(t){var u=n.extend({dataAttr:"jqdata",json:null,beforeBind:function(){},afterBind:function(){},dataChanged:function(){}},t),r=this,e=jQuery.extend(!0,{},u.json),i=u.dataAttr;r.data("templates",{});var o=function(t){var u=n(t.target),e=u.attr("data-"+i),f=u.val();u.is("[data-"+i+"-format]")&&(f=f.replace(new RegExp(u.attr("data-"+i+"-format").replace("{value}","|"),"ig"),""));l(e,f);h(r,e,f)},s=function(t){var r=n(t.target),u=r.attr("data-"+i+"-format");r.val(r.val().replace(new RegExp(u.replace("{value}","|"),"ig"),""))},h=function(t,f,e){var v,h,c,a,l;if(t||(t=n("body")),v=n("[data-"+i+'="'+f+'"]',t),e!=null&&typeof e=="object"&&e.hasOwnProperty(0)&&(h=n("[data-"+i+'="'+f+'.{n}"]',t),h.length>0))for(c=r.data("templates")[f+".{n}"],a=h.parent(),typeof c=="undefined"&&(c=r.data("templates")[f+".{n}"]={ref:h.clone(),html:h.prop("outerHTML"),prt:a},h.remove()),l=0;l<e.length;l++)a.append(c.html.replace(new RegExp('"'+f+".{n}","g"),'"'+f+"."+l));v.each(function(){var t,r,c,h;if(typeof e!="object"&&(t=e,n(this).is("[data-"+i+"-format]")&&(t=n(this).attr("data-"+i+"-format").replace("\\","").replace("{value}",t)),n(this).is(':input[type="radio"], :input[type="checkbox"]')?n(this).is('[value="'+t+'"]')&&n(this).prop("checked",!0):n(this).is(":input")&&!n(this).is(":focus")?n(this).val(t):n(this).html(t)),n(this).is("[data-"+i+"-databind]")&&(r=n(this).attr("data-"+i+"-databind"),typeof window[r]=="function"&&window[r].apply(this,[n(this),e,u.json,f])),n(this).is("[data-"+i+"-format]")){c=n(this).attr("data-"+i+"-format");n(this).off("focus",s).on("focus",s)}if(n(this).is("[data-"+i+"-bindevent]")){h=n(this).attr("data-"+i+"-bindevent");n(this).off(h,o).on(h,o)}})},c=function(n,t,i,r){var u,f;for(u in t)f=typeof r!="undefined"?r+"."+u:u,i.apply(this,[n,f,t[u]]),t[u]!==null&&typeof t[u]=="object"&&c(n,t[u],i,f)},l=function(n,t){for(var f=n.split("."),e=u.json,o="",i=0;i<f.length;i++)if(typeof e[f[i]]=="undefined"){e[f[i]]=null;break}else typeof e[f[i]]=="object"?e=e[f[i]]:(o=e[f[i]],e[f[i]]=t);u.dataChanged(r,n,o,t)},a=function(){n("[data-"+i+'$=".{n}"]',r).remove()},f=function(){u.beforeBind(r);c(r,u.json,h);a();u.afterBind(r)};return r.rebind=function(){f()},r.getData=function(){return u.json},r.getOriginalData=function(){return e},r.reset=function(){u.json=jQuery.extend(!0,{},e);f()},f(),r}})(jQuery);